-- ============================================
-- AUDITORIA: REMOVER LANCAMENTOS DUPLICADOS
-- Data: 2025-12-30
-- ============================================
-- RESUMO:
-- Total de lancamentos: 7,447
-- Lancamentos duplicados: 96 (1.29%)
-- Valor total em duplicatas: R$ 135,828.05
-- ============================================
-- PRINCIPAIS CLIENTES COM DUPLICATAS:
-- W.G. DE ALMEIDA DESIGNER DE INTERIORES: 67 (R$ 96,939.68)
-- Roberto Grejo: 4 (R$ 4,020.00)
-- JVCORPORATE LTDA: 3 (R$ 5,000.00)
-- ============================================

BEGIN;

-- 1. BACKUP DOS REGISTROS A SEREM REMOVIDOS
DROP TABLE IF EXISTS financeiro_lancamentos_backup_duplicatas;

CREATE TABLE financeiro_lancamentos_backup_duplicatas AS
SELECT * FROM financeiro_lancamentos WHERE id IN (
    '7302234d-af0a-4b36-8bcf-fc2185bbaa03',
    '99c53bf5-b727-418b-ae75-72845ad7e190',
    '112193c3-b2be-411d-952a-d36110f0bb60',
    'a0b69c69-3239-4807-8f1b-6d2e1ba284d3',
    'd80a6405-1198-4176-b2b1-4989dce14360',
    '0df6e50e-4f91-4ffd-8f93-3e7f18a5d515',
    '947eb191-703d-4d76-939c-ebaba46c9567',
    '525335e6-ec4d-462e-a358-05fd3265b675',
    '12e816e1-84ce-4f0c-800e-104a0809b69b',
    '9a28d1a9-428a-4cb3-a135-3a37af328b37',
    '92ec3bc7-60ad-4f3d-a74e-2f1ca05a971f',
    '48d24518-6fcf-4a8f-8be8-5b796250c507',
    'e544aee4-1e72-48ff-9a9c-64aa23673bea',
    'ccb84062-d365-41b2-a5f1-58745dde753a',
    '98ad4bde-3cf7-4655-81ce-56afe161f582',
    '77246a49-3460-4120-9586-1ac2cb472b61',
    'f873e1a3-c750-448c-856f-aaa5eb7ec04c',
    '30f2e641-f3b9-43be-a8b1-968ce6f60c89',
    '9fbb6fe5-6111-4c91-a65b-a01e7fefde2c',
    '73a8ce1c-44a9-4b0a-85a2-ea6ce233f64a',
    '99b42a91-7dca-44bd-afae-37968280e708',
    '111e1d9d-7e8c-4d41-bb5c-f230f017a464',
    '56b95dbe-c462-4c7c-b62a-339c487cbe3e',
    '90da8107-17db-4e7c-a11f-9f6f304ac516',
    '9b9a1792-c79c-4fd0-ae1f-2910c791a1b0',
    '66af6df1-5707-43d4-b548-2a1528c31ac6',
    '40a34017-ce3b-444e-9691-bc679e93bb18',
    'f59a8579-0ce7-4db1-9ff7-05b218cdd7c7',
    '7e7b159c-5b5d-4aa8-abba-cefa11a76534',
    'ed22ad4d-d767-4cc7-a7e2-f585d52733db',
    'be26b38d-ee8d-46fb-86cd-68e89be0d910',
    'ad523c93-baef-4537-b635-a94d565b3626',
    '6296b49d-6e11-4273-b68d-8e921f2c3053',
    'd5287f99-b3fd-4c5e-bd49-a8b062e6e7c3',
    '93ccd0e8-e32f-4bec-9562-f661f3eb33b6',
    'acada8ec-9891-4c1c-911c-54d04531612f',
    'e5daff8d-243c-4ef7-ae10-71c756f1c19d',
    '292ec2d7-c36d-4818-a6ca-e3f793f3e2b3',
    '9b9e5ae0-02e2-4bce-8002-66b1bc46c079',
    '103990c3-dfe9-4623-a2b6-808cb7bd9e76',
    'c9015794-c2ab-4c68-848e-d4834461993c',
    'f1b430a9-f6ab-4195-a462-42d237921abd',
    'd0239d22-ec61-4585-8219-9ec31038d4bb',
    '3dcf3b1d-5643-4305-bffb-832da71adf2f',
    '55488489-65e9-46e9-9bb2-c1ff2c647491',
    '01e77182-7c83-4ba4-b31a-7c8e964f52f8',
    'a218854b-0a42-48e0-ac62-4e418dca60f8',
    'e90bbf88-a09d-4b4c-9aee-a07d6dbe4d5b',
    'fbfa05c8-fe12-42ac-8850-6416b3781d68',
    'cd105729-5792-49c5-9e00-5daea671d403',
    'd04c97c8-80ac-4109-805a-db2ccd8e6321',
    '721d2c72-c2e6-47e1-ae39-c96dfb9f6bc0',
    '9e92982e-8428-4449-9a64-3b47871cdaef',
    '16c3be3e-bded-4a0a-aabc-9836116154ed',
    '2e34c21a-e9dd-4676-9685-3e885f77e453',
    'f9813740-134c-406a-9aa3-f302cf0d7ffe',
    '43c4640d-4f3e-4b64-bc3f-cd74e8849759',
    '0d81a02c-e074-43f9-8ba1-61ccc9fb9876',
    '5a4729c1-2c7b-400b-9ed0-2cbe27892a80',
    'a0f47ab6-26e8-4cca-ae6d-462b37bd514d',
    'bacfa1e1-0678-49f6-8404-5b8f0c7f4982',
    '2f62cd92-caf1-4bb3-8222-283383ff7ab3',
    'a8f412dc-a702-4912-8482-559f7d20b614',
    'c8aafb82-9b5b-4816-92a0-e1b57b130c03',
    'c171b020-a8c2-4ed5-977c-a4bf41395f17',
    '0b4282b4-5bd8-46a1-a39d-f43c707732f6',
    '8a1f68eb-94fb-4b24-8606-96bc29012b7b',
    '429a6708-7baa-4315-8619-1c0a52637b7e',
    'c45e0e05-f126-4354-b336-3646a3828a4a',
    'ad1a04f5-d61e-412e-a0fa-f7d65dacb56d',
    'f38cd2fd-d7ba-4325-bd2d-9de1312ef2b5',
    '52343f62-10cd-45e7-bc82-de91db394bd9',
    '304769f0-2c70-4a61-8794-a64bd2150350',
    '0ef9ea60-c09c-4c3c-85b3-e362552c8c57',
    '45ded7ff-5345-4df1-97af-61370ec7079a',
    '07585deb-2e81-4a32-8d27-95cfa155d9f2',
    '488f5713-e6d1-4db4-b105-4ae765b02048',
    '988016c4-04f2-4748-b3cd-180e64bd497b',
    '6e7a9829-48a6-417b-8879-3595e34ebd02',
    'c9a11dc4-316d-4081-a545-cc2db1eed18e',
    'ebb21a64-1455-4db9-b361-6b8b77ac1317',
    '9a8562a8-eada-46ee-8e5c-759abccce855',
    'd80e13b8-bd1e-43e5-a9ca-3e66576b3622',
    'ec3a7fd4-0853-48e4-9532-37acf315acf1',
    'ff7fe8df-1a2e-4a12-95e4-2f679a9dd9a6',
    'b0c049ff-2303-44b9-ade7-1bd0cd9ef112',
    '67a4c2d1-c661-4529-9b57-98919ea0ba23',
    'a25daf46-962a-4e22-b856-253f4dcd66c4',
    'd765df7f-ac6c-47c2-a275-42d2f1455f88',
    'ce495298-ff1e-4efc-9f67-187c40f1052c',
    'c6c6423c-a387-4aac-a3ad-9d14b4466ad5',
    '8d14944d-3a8b-471c-a10d-cda80e5c525d',
    'adbb7ca4-ff97-42b9-a0fb-ff86b5787deb',
    'e6672e53-f16a-4816-9039-87d2f33107cc',
    '18f01e4c-404b-4136-a827-3c9304c83e15',
    '68c70fb2-8583-4101-85ba-0167e376cc58'
);

-- 2. VERIFICAR BACKUP
SELECT 'BACKUP CRIADO' as status, COUNT(*) as registros FROM financeiro_lancamentos_backup_duplicatas;

-- 3. REMOVER DUPLICATAS (manter o registro mais antigo de cada grupo)
DELETE FROM financeiro_lancamentos WHERE id IN (
    '7302234d-af0a-4b36-8bcf-fc2185bbaa03',
    '99c53bf5-b727-418b-ae75-72845ad7e190',
    '112193c3-b2be-411d-952a-d36110f0bb60',
    'a0b69c69-3239-4807-8f1b-6d2e1ba284d3',
    'd80a6405-1198-4176-b2b1-4989dce14360',
    '0df6e50e-4f91-4ffd-8f93-3e7f18a5d515',
    '947eb191-703d-4d76-939c-ebaba46c9567',
    '525335e6-ec4d-462e-a358-05fd3265b675',
    '12e816e1-84ce-4f0c-800e-104a0809b69b',
    '9a28d1a9-428a-4cb3-a135-3a37af328b37',
    '92ec3bc7-60ad-4f3d-a74e-2f1ca05a971f',
    '48d24518-6fcf-4a8f-8be8-5b796250c507',
    'e544aee4-1e72-48ff-9a9c-64aa23673bea',
    'ccb84062-d365-41b2-a5f1-58745dde753a',
    '98ad4bde-3cf7-4655-81ce-56afe161f582',
    '77246a49-3460-4120-9586-1ac2cb472b61',
    'f873e1a3-c750-448c-856f-aaa5eb7ec04c',
    '30f2e641-f3b9-43be-a8b1-968ce6f60c89',
    '9fbb6fe5-6111-4c91-a65b-a01e7fefde2c',
    '73a8ce1c-44a9-4b0a-85a2-ea6ce233f64a',
    '99b42a91-7dca-44bd-afae-37968280e708',
    '111e1d9d-7e8c-4d41-bb5c-f230f017a464',
    '56b95dbe-c462-4c7c-b62a-339c487cbe3e',
    '90da8107-17db-4e7c-a11f-9f6f304ac516',
    '9b9a1792-c79c-4fd0-ae1f-2910c791a1b0',
    '66af6df1-5707-43d4-b548-2a1528c31ac6',
    '40a34017-ce3b-444e-9691-bc679e93bb18',
    'f59a8579-0ce7-4db1-9ff7-05b218cdd7c7',
    '7e7b159c-5b5d-4aa8-abba-cefa11a76534',
    'ed22ad4d-d767-4cc7-a7e2-f585d52733db',
    'be26b38d-ee8d-46fb-86cd-68e89be0d910',
    'ad523c93-baef-4537-b635-a94d565b3626',
    '6296b49d-6e11-4273-b68d-8e921f2c3053',
    'd5287f99-b3fd-4c5e-bd49-a8b062e6e7c3',
    '93ccd0e8-e32f-4bec-9562-f661f3eb33b6',
    'acada8ec-9891-4c1c-911c-54d04531612f',
    'e5daff8d-243c-4ef7-ae10-71c756f1c19d',
    '292ec2d7-c36d-4818-a6ca-e3f793f3e2b3',
    '9b9e5ae0-02e2-4bce-8002-66b1bc46c079',
    '103990c3-dfe9-4623-a2b6-808cb7bd9e76',
    'c9015794-c2ab-4c68-848e-d4834461993c',
    'f1b430a9-f6ab-4195-a462-42d237921abd',
    'd0239d22-ec61-4585-8219-9ec31038d4bb',
    '3dcf3b1d-5643-4305-bffb-832da71adf2f',
    '55488489-65e9-46e9-9bb2-c1ff2c647491',
    '01e77182-7c83-4ba4-b31a-7c8e964f52f8',
    'a218854b-0a42-48e0-ac62-4e418dca60f8',
    'e90bbf88-a09d-4b4c-9aee-a07d6dbe4d5b',
    'fbfa05c8-fe12-42ac-8850-6416b3781d68',
    'cd105729-5792-49c5-9e00-5daea671d403',
    'd04c97c8-80ac-4109-805a-db2ccd8e6321',
    '721d2c72-c2e6-47e1-ae39-c96dfb9f6bc0',
    '9e92982e-8428-4449-9a64-3b47871cdaef',
    '16c3be3e-bded-4a0a-aabc-9836116154ed',
    '2e34c21a-e9dd-4676-9685-3e885f77e453',
    'f9813740-134c-406a-9aa3-f302cf0d7ffe',
    '43c4640d-4f3e-4b64-bc3f-cd74e8849759',
    '0d81a02c-e074-43f9-8ba1-61ccc9fb9876',
    '5a4729c1-2c7b-400b-9ed0-2cbe27892a80',
    'a0f47ab6-26e8-4cca-ae6d-462b37bd514d',
    'bacfa1e1-0678-49f6-8404-5b8f0c7f4982',
    '2f62cd92-caf1-4bb3-8222-283383ff7ab3',
    'a8f412dc-a702-4912-8482-559f7d20b614',
    'c8aafb82-9b5b-4816-92a0-e1b57b130c03',
    'c171b020-a8c2-4ed5-977c-a4bf41395f17',
    '0b4282b4-5bd8-46a1-a39d-f43c707732f6',
    '8a1f68eb-94fb-4b24-8606-96bc29012b7b',
    '429a6708-7baa-4315-8619-1c0a52637b7e',
    'c45e0e05-f126-4354-b336-3646a3828a4a',
    'ad1a04f5-d61e-412e-a0fa-f7d65dacb56d',
    'f38cd2fd-d7ba-4325-bd2d-9de1312ef2b5',
    '52343f62-10cd-45e7-bc82-de91db394bd9',
    '304769f0-2c70-4a61-8794-a64bd2150350',
    '0ef9ea60-c09c-4c3c-85b3-e362552c8c57',
    '45ded7ff-5345-4df1-97af-61370ec7079a',
    '07585deb-2e81-4a32-8d27-95cfa155d9f2',
    '488f5713-e6d1-4db4-b105-4ae765b02048',
    '988016c4-04f2-4748-b3cd-180e64bd497b',
    '6e7a9829-48a6-417b-8879-3595e34ebd02',
    'c9a11dc4-316d-4081-a545-cc2db1eed18e',
    'ebb21a64-1455-4db9-b361-6b8b77ac1317',
    '9a8562a8-eada-46ee-8e5c-759abccce855',
    'd80e13b8-bd1e-43e5-a9ca-3e66576b3622',
    'ec3a7fd4-0853-48e4-9532-37acf315acf1',
    'ff7fe8df-1a2e-4a12-95e4-2f679a9dd9a6',
    'b0c049ff-2303-44b9-ade7-1bd0cd9ef112',
    '67a4c2d1-c661-4529-9b57-98919ea0ba23',
    'a25daf46-962a-4e22-b856-253f4dcd66c4',
    'd765df7f-ac6c-47c2-a275-42d2f1455f88',
    'ce495298-ff1e-4efc-9f67-187c40f1052c',
    'c6c6423c-a387-4aac-a3ad-9d14b4466ad5',
    '8d14944d-3a8b-471c-a10d-cda80e5c525d',
    'adbb7ca4-ff97-42b9-a0fb-ff86b5787deb',
    'e6672e53-f16a-4816-9039-87d2f33107cc',
    '18f01e4c-404b-4136-a827-3c9304c83e15',
    '68c70fb2-8583-4101-85ba-0167e376cc58'
);

-- 4. VERIFICAR RESULTADO
SELECT 'LIMPEZA CONCLUIDA' as status, COUNT(*) as total_restante FROM financeiro_lancamentos;

-- 5. VERIFICAR SE AINDA EXISTEM DUPLICATAS
SELECT 'DUPLICATAS RESTANTES' as status, COUNT(*) as qtd FROM (
    SELECT 1
    FROM financeiro_lancamentos fl
    GROUP BY fl.data_competencia, fl.valor_total, fl.pessoa_id, fl.descricao
    HAVING COUNT(*) > 1
) sub;

COMMIT;
